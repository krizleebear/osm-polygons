# OSM polygon export pipeline
# Exports polygons of localities to geoJSON streams.

name: polygon-pipeline

variables:
  imageName: 'polygon-export-docker'

trigger:
- none

pool:
  vmImage: 'ubuntu-latest'

jobs:

- job: export
  container: 
    image: krizleebear/docker-osmium-tool:v1.18.0
    endpoint: docker-krizleebear

  strategy:
    matrix:
      #TODO: populate matrix config programatically
      algeria:
        OSM_REGION: 'algeria'
        PBF_URL: 'https://download.geofabrik.de/africa/algeria-latest.osm.pbf'
        COUNTRY_CODE: 'DZ'
      angola:
        OSM_REGION: 'angola'
        PBF_URL: 'https://download.geofabrik.de/africa/angola-latest.osm.pbf'
        COUNTRY_CODE: 'AO'
      benin:
        OSM_REGION: 'benin'
        PBF_URL: 'https://download.geofabrik.de/africa/benin-latest.osm.pbf'
        COUNTRY_CODE: 'BJ'
      botswana:
        OSM_REGION: 'botswana'
        PBF_URL: 'https://download.geofabrik.de/africa/botswana-latest.osm.pbf'
        COUNTRY_CODE: 'BW'
      burkina-faso:
        OSM_REGION: 'burkina-faso'
        PBF_URL: 'https://download.geofabrik.de/africa/burkina-faso-latest.osm.pbf'
        COUNTRY_CODE: 'BF'
      burundi:
        OSM_REGION: 'burundi'
        PBF_URL: 'https://download.geofabrik.de/africa/burundi-latest.osm.pbf'
        COUNTRY_CODE: 'BI'
      cameroon:
        OSM_REGION: 'cameroon'
        PBF_URL: 'https://download.geofabrik.de/africa/cameroon-latest.osm.pbf'
        COUNTRY_CODE: 'CM'
      canary-islands:
        OSM_REGION: 'canary-islands'
        PBF_URL: 'https://download.geofabrik.de/africa/canary-islands-latest.osm.pbf'
        COUNTRY_CODE: 'ES-CN'
      cape-verde:
        OSM_REGION: 'cape-verde'
        PBF_URL: 'https://download.geofabrik.de/africa/cape-verde-latest.osm.pbf'
        COUNTRY_CODE: 'CV'
      central-african-republic:
        OSM_REGION: 'central-african-republic'
        PBF_URL: 'https://download.geofabrik.de/africa/central-african-republic-latest.osm.pbf'
        COUNTRY_CODE: 'CF'
      chad:
        OSM_REGION: 'chad'
        PBF_URL: 'https://download.geofabrik.de/africa/chad-latest.osm.pbf'
        COUNTRY_CODE: 'TD'
      comores:
        OSM_REGION: 'comores'
        PBF_URL: 'https://download.geofabrik.de/africa/comores-latest.osm.pbf'
        COUNTRY_CODE: 'KM'
      congo-brazzaville:
        OSM_REGION: 'congo-brazzaville'
        PBF_URL: 'https://download.geofabrik.de/africa/congo-brazzaville-latest.osm.pbf'
        COUNTRY_CODE: 'CG'
      congo-democratic-republic:
        OSM_REGION: 'congo-democratic-republic'
        PBF_URL: 'https://download.geofabrik.de/africa/congo-democratic-republic-latest.osm.pbf'
        COUNTRY_CODE: 'CD'
      djibouti:
        OSM_REGION: 'djibouti'
        PBF_URL: 'https://download.geofabrik.de/africa/djibouti-latest.osm.pbf'
        COUNTRY_CODE: 'DJ'
      egypt:
        OSM_REGION: 'egypt'
        PBF_URL: 'https://download.geofabrik.de/africa/egypt-latest.osm.pbf'
        COUNTRY_CODE: 'EG'
      equatorial-guinea:
        OSM_REGION: 'equatorial-guinea'
        PBF_URL: 'https://download.geofabrik.de/africa/equatorial-guinea-latest.osm.pbf'
        COUNTRY_CODE: 'GQ'
      eritrea:
        OSM_REGION: 'eritrea'
        PBF_URL: 'https://download.geofabrik.de/africa/eritrea-latest.osm.pbf'
        COUNTRY_CODE: 'ER'
      ethiopia:
        OSM_REGION: 'ethiopia'
        PBF_URL: 'https://download.geofabrik.de/africa/ethiopia-latest.osm.pbf'
        COUNTRY_CODE: 'ET'
      gabon:
        OSM_REGION: 'gabon'
        PBF_URL: 'https://download.geofabrik.de/africa/gabon-latest.osm.pbf'
        COUNTRY_CODE: 'GA'
      ghana:
        OSM_REGION: 'ghana'
        PBF_URL: 'https://download.geofabrik.de/africa/ghana-latest.osm.pbf'
        COUNTRY_CODE: 'GH'
      guinea:
        OSM_REGION: 'guinea'
        PBF_URL: 'https://download.geofabrik.de/africa/guinea-latest.osm.pbf'
        COUNTRY_CODE: 'GN'
      guinea-bissau:
        OSM_REGION: 'guinea-bissau'
        PBF_URL: 'https://download.geofabrik.de/africa/guinea-bissau-latest.osm.pbf'
        COUNTRY_CODE: 'GW'
      ivory-coast:
        OSM_REGION: 'ivory-coast'
        PBF_URL: 'https://download.geofabrik.de/africa/ivory-coast-latest.osm.pbf'
        COUNTRY_CODE: 'CI'
      kenya:
        OSM_REGION: 'kenya'
        PBF_URL: 'https://download.geofabrik.de/africa/kenya-latest.osm.pbf'
        COUNTRY_CODE: 'KE'
      lesotho:
        OSM_REGION: 'lesotho'
        PBF_URL: 'https://download.geofabrik.de/africa/lesotho-latest.osm.pbf'
        COUNTRY_CODE: 'LS'
      liberia:
        OSM_REGION: 'liberia'
        PBF_URL: 'https://download.geofabrik.de/africa/liberia-latest.osm.pbf'
        COUNTRY_CODE: 'LR'
      libya:
        OSM_REGION: 'libya'
        PBF_URL: 'https://download.geofabrik.de/africa/libya-latest.osm.pbf'
        COUNTRY_CODE: 'LY'
      madagascar:
        OSM_REGION: 'madagascar'
        PBF_URL: 'https://download.geofabrik.de/africa/madagascar-latest.osm.pbf'
        COUNTRY_CODE: 'MG'
      malawi:
        OSM_REGION: 'malawi'
        PBF_URL: 'https://download.geofabrik.de/africa/malawi-latest.osm.pbf'
        COUNTRY_CODE: 'MW'
      mali:
        OSM_REGION: 'mali'
        PBF_URL: 'https://download.geofabrik.de/africa/mali-latest.osm.pbf'
        COUNTRY_CODE: 'ML'
      mauritania:
        OSM_REGION: 'mauritania'
        PBF_URL: 'https://download.geofabrik.de/africa/mauritania-latest.osm.pbf'
        COUNTRY_CODE: 'MR'
      mauritius:
        OSM_REGION: 'mauritius'
        PBF_URL: 'https://download.geofabrik.de/africa/mauritius-latest.osm.pbf'
        COUNTRY_CODE: 'MU'
      morocco:
        OSM_REGION: 'morocco'
        PBF_URL: 'https://download.geofabrik.de/africa/morocco-latest.osm.pbf'
        COUNTRY_CODE: 'MA'
      mozambique:
        OSM_REGION: 'mozambique'
        PBF_URL: 'https://download.geofabrik.de/africa/mozambique-latest.osm.pbf'
        COUNTRY_CODE: 'MZ'
      namibia:
        OSM_REGION: 'namibia'
        PBF_URL: 'https://download.geofabrik.de/africa/namibia-latest.osm.pbf'
        COUNTRY_CODE: 'NA'
      niger:
        OSM_REGION: 'niger'
        PBF_URL: 'https://download.geofabrik.de/africa/niger-latest.osm.pbf'
        COUNTRY_CODE: 'NE'
      nigeria:
        OSM_REGION: 'nigeria'
        PBF_URL: 'https://download.geofabrik.de/africa/nigeria-latest.osm.pbf'
        COUNTRY_CODE: 'NG'
      rwanda:
        OSM_REGION: 'rwanda'
        PBF_URL: 'https://download.geofabrik.de/africa/rwanda-latest.osm.pbf'
        COUNTRY_CODE: 'RW'
      saint-helena-ascension-and-tristan-da-cunha:
        OSM_REGION: 'saint-helena-ascension-and-tristan-da-cunha'
        PBF_URL: 'https://download.geofabrik.de/africa/saint-helena-ascension-and-tristan-da-cunha-latest.osm.pbf'
        COUNTRY_CODE: 'SH'
      sao-tome-and-principe:
        OSM_REGION: 'sao-tome-and-principe'
        PBF_URL: 'https://download.geofabrik.de/africa/sao-tome-and-principe-latest.osm.pbf'
        COUNTRY_CODE: 'ST'
      senegal-and-gambia:
        OSM_REGION: 'senegal-and-gambia'
        PBF_URL: 'https://download.geofabrik.de/africa/senegal-and-gambia-latest.osm.pbf'
        COUNTRY_CODE: 'SN'
      seychelles:
        OSM_REGION: 'seychelles'
        PBF_URL: 'https://download.geofabrik.de/africa/seychelles-latest.osm.pbf'
        COUNTRY_CODE: 'SC'
      sierra-leone:
        OSM_REGION: 'sierra-leone'
        PBF_URL: 'https://download.geofabrik.de/africa/sierra-leone-latest.osm.pbf'
        COUNTRY_CODE: 'SL'
      somalia:
        OSM_REGION: 'somalia'
        PBF_URL: 'https://download.geofabrik.de/africa/somalia-latest.osm.pbf'
        COUNTRY_CODE: 'SO'
      south-africa:
        OSM_REGION: 'south-africa'
        PBF_URL: 'https://download.geofabrik.de/africa/south-africa-latest.osm.pbf'
        COUNTRY_CODE: 'ZA'
      south-sudan:
        OSM_REGION: 'south-sudan'
        PBF_URL: 'https://download.geofabrik.de/africa/south-sudan-latest.osm.pbf'
        COUNTRY_CODE: 'SS'
      sudan:
        OSM_REGION: 'sudan'
        PBF_URL: 'https://download.geofabrik.de/africa/sudan-latest.osm.pbf'
        COUNTRY_CODE: 'SD'
      swaziland:
        OSM_REGION: 'swaziland'
        PBF_URL: 'https://download.geofabrik.de/africa/swaziland-latest.osm.pbf'
        COUNTRY_CODE: 'SZ'
      tanzania:
        OSM_REGION: 'tanzania'
        PBF_URL: 'https://download.geofabrik.de/africa/tanzania-latest.osm.pbf'
        COUNTRY_CODE: 'TZ'
      togo:
        OSM_REGION: 'togo'
        PBF_URL: 'https://download.geofabrik.de/africa/togo-latest.osm.pbf'
        COUNTRY_CODE: 'TG'
      tunisia:
        OSM_REGION: 'tunisia'
        PBF_URL: 'https://download.geofabrik.de/africa/tunisia-latest.osm.pbf'
        COUNTRY_CODE: 'TN'
      uganda:
        OSM_REGION: 'uganda'
        PBF_URL: 'https://download.geofabrik.de/africa/uganda-latest.osm.pbf'
        COUNTRY_CODE: 'UG'
      zambia:
        OSM_REGION: 'zambia'
        PBF_URL: 'https://download.geofabrik.de/africa/zambia-latest.osm.pbf'
        COUNTRY_CODE: 'ZM'
      zimbabwe:
        OSM_REGION: 'zimbabwe'
        PBF_URL: 'https://download.geofabrik.de/africa/zimbabwe-latest.osm.pbf'
        COUNTRY_CODE: 'ZW'
      afghanistan:
        OSM_REGION: 'afghanistan'
        PBF_URL: 'https://download.geofabrik.de/asia/afghanistan-latest.osm.pbf'
        COUNTRY_CODE: 'AF'
      armenia:
        OSM_REGION: 'armenia'
        PBF_URL: 'https://download.geofabrik.de/asia/armenia-latest.osm.pbf'
        COUNTRY_CODE: 'AM'
      azerbaijan:
        OSM_REGION: 'azerbaijan'
        PBF_URL: 'https://download.geofabrik.de/asia/azerbaijan-latest.osm.pbf'
        COUNTRY_CODE: 'AZ'
      bangladesh:
        OSM_REGION: 'bangladesh'
        PBF_URL: 'https://download.geofabrik.de/asia/bangladesh-latest.osm.pbf'
        COUNTRY_CODE: 'BD'
      bhutan:
        OSM_REGION: 'bhutan'
        PBF_URL: 'https://download.geofabrik.de/asia/bhutan-latest.osm.pbf'
        COUNTRY_CODE: 'BT'
      cambodia:
        OSM_REGION: 'cambodia'
        PBF_URL: 'https://download.geofabrik.de/asia/cambodia-latest.osm.pbf'
        COUNTRY_CODE: 'KH'
      china:
        OSM_REGION: 'china'
        PBF_URL: 'https://download.geofabrik.de/asia/china-latest.osm.pbf'
        COUNTRY_CODE: 'CN'
      gcc-states:
        OSM_REGION: 'gcc-states'
        PBF_URL: 'https://download.geofabrik.de/asia/gcc-states-latest.osm.pbf'
        COUNTRY_CODE: 'AE'
      india:
        OSM_REGION: 'india'
        PBF_URL: 'https://download.geofabrik.de/asia/india-latest.osm.pbf'
        COUNTRY_CODE: 'IN'
      indonesia:
        OSM_REGION: 'indonesia'
        PBF_URL: 'https://download.geofabrik.de/asia/indonesia-latest.osm.pbf'
        COUNTRY_CODE: 'ID'
      iran:
        OSM_REGION: 'iran'
        PBF_URL: 'https://download.geofabrik.de/asia/iran-latest.osm.pbf'
        COUNTRY_CODE: 'IR'
      iraq:
        OSM_REGION: 'iraq'
        PBF_URL: 'https://download.geofabrik.de/asia/iraq-latest.osm.pbf'
        COUNTRY_CODE: 'IQ'
      israel-and-palestine:
        OSM_REGION: 'israel-and-palestine'
        PBF_URL: 'https://download.geofabrik.de/asia/israel-and-palestine-latest.osm.pbf'
        COUNTRY_CODE: 'IL'
      japan:
        OSM_REGION: 'japan'
        PBF_URL: 'https://download.geofabrik.de/asia/japan-latest.osm.pbf'
        COUNTRY_CODE: 'JP'
      jordan:
        OSM_REGION: 'jordan'
        PBF_URL: 'https://download.geofabrik.de/asia/jordan-latest.osm.pbf'
        COUNTRY_CODE: 'JO'
      kazakhstan:
        OSM_REGION: 'kazakhstan'
        PBF_URL: 'https://download.geofabrik.de/asia/kazakhstan-latest.osm.pbf'
        COUNTRY_CODE: 'KZ'
      kyrgyzstan:
        OSM_REGION: 'kyrgyzstan'
        PBF_URL: 'https://download.geofabrik.de/asia/kyrgyzstan-latest.osm.pbf'
        COUNTRY_CODE: 'KG'
      laos:
        OSM_REGION: 'laos'
        PBF_URL: 'https://download.geofabrik.de/asia/laos-latest.osm.pbf'
        COUNTRY_CODE: 'LA'
      lebanon:
        OSM_REGION: 'lebanon'
        PBF_URL: 'https://download.geofabrik.de/asia/lebanon-latest.osm.pbf'
        COUNTRY_CODE: 'LB'
      malaysia-singapore-brunei:
        OSM_REGION: 'malaysia-singapore-brunei'
        PBF_URL: 'https://download.geofabrik.de/asia/malaysia-singapore-brunei-latest.osm.pbf'
        COUNTRY_CODE: 'MY'
      maldives:
        OSM_REGION: 'maldives'
        PBF_URL: 'https://download.geofabrik.de/asia/maldives-latest.osm.pbf'
        COUNTRY_CODE: 'MV'
      mongolia:
        OSM_REGION: 'mongolia'
        PBF_URL: 'https://download.geofabrik.de/asia/mongolia-latest.osm.pbf'
        COUNTRY_CODE: 'MN'
      myanmar:
        OSM_REGION: 'myanmar'
        PBF_URL: 'https://download.geofabrik.de/asia/myanmar-latest.osm.pbf'
        COUNTRY_CODE: 'MM'
      nepal:
        OSM_REGION: 'nepal'
        PBF_URL: 'https://download.geofabrik.de/asia/nepal-latest.osm.pbf'
        COUNTRY_CODE: 'NP'
      north-korea:
        OSM_REGION: 'north-korea'
        PBF_URL: 'https://download.geofabrik.de/asia/north-korea-latest.osm.pbf'
        COUNTRY_CODE: 'KP'
      pakistan:
        OSM_REGION: 'pakistan'
        PBF_URL: 'https://download.geofabrik.de/asia/pakistan-latest.osm.pbf'
        COUNTRY_CODE: 'PK'
      philippines:
        OSM_REGION: 'philippines'
        PBF_URL: 'https://download.geofabrik.de/asia/philippines-latest.osm.pbf'
        COUNTRY_CODE: 'PH'
      south-korea:
        OSM_REGION: 'south-korea'
        PBF_URL: 'https://download.geofabrik.de/asia/south-korea-latest.osm.pbf'
        COUNTRY_CODE: 'KR'
      sri-lanka:
        OSM_REGION: 'sri-lanka'
        PBF_URL: 'https://download.geofabrik.de/asia/sri-lanka-latest.osm.pbf'
        COUNTRY_CODE: 'LK'
      syria:
        OSM_REGION: 'syria'
        PBF_URL: 'https://download.geofabrik.de/asia/syria-latest.osm.pbf'
        COUNTRY_CODE: 'SY'
      taiwan:
        OSM_REGION: 'taiwan'
        PBF_URL: 'https://download.geofabrik.de/asia/taiwan-latest.osm.pbf'
        COUNTRY_CODE: 'TW'
      tajikistan:
        OSM_REGION: 'tajikistan'
        PBF_URL: 'https://download.geofabrik.de/asia/tajikistan-latest.osm.pbf'
        COUNTRY_CODE: 'TJ'
      thailand:
        OSM_REGION: 'thailand'
        PBF_URL: 'https://download.geofabrik.de/asia/thailand-latest.osm.pbf'
        COUNTRY_CODE: 'TH'
      turkmenistan:
        OSM_REGION: 'turkmenistan'
        PBF_URL: 'https://download.geofabrik.de/asia/turkmenistan-latest.osm.pbf'
        COUNTRY_CODE: 'TM'
      uzbekistan:
        OSM_REGION: 'uzbekistan'
        PBF_URL: 'https://download.geofabrik.de/asia/uzbekistan-latest.osm.pbf'
        COUNTRY_CODE: 'UZ'
      vietnam:
        OSM_REGION: 'vietnam'
        PBF_URL: 'https://download.geofabrik.de/asia/vietnam-latest.osm.pbf'
        COUNTRY_CODE: 'VN'
      yemen:
        OSM_REGION: 'yemen'
        PBF_URL: 'https://download.geofabrik.de/asia/yemen-latest.osm.pbf'
        COUNTRY_CODE: 'YE'
      australia:
        OSM_REGION: 'australia'
        PBF_URL: 'https://download.geofabrik.de/australia-oceania/australia-latest.osm.pbf'
        COUNTRY_CODE: 'AU'
      fiji:
        OSM_REGION: 'fiji'
        PBF_URL: 'https://download.geofabrik.de/australia-oceania/fiji-latest.osm.pbf'
        COUNTRY_CODE: 'FJ'
      new-caledonia:
        OSM_REGION: 'new-caledonia'
        PBF_URL: 'https://download.geofabrik.de/australia-oceania/new-caledonia-latest.osm.pbf'
        COUNTRY_CODE: 'NC'
      new-zealand:
        OSM_REGION: 'new-zealand'
        PBF_URL: 'https://download.geofabrik.de/australia-oceania/new-zealand-latest.osm.pbf'
        COUNTRY_CODE: 'NZ'
      papua-new-guinea:
        OSM_REGION: 'papua-new-guinea'
        PBF_URL: 'https://download.geofabrik.de/australia-oceania/papua-new-guinea-latest.osm.pbf'
        COUNTRY_CODE: 'PG'
      bahamas:
        OSM_REGION: 'bahamas'
        PBF_URL: 'https://download.geofabrik.de/central-america/bahamas-latest.osm.pbf'
        COUNTRY_CODE: 'BS'
      belize:
        OSM_REGION: 'belize'
        PBF_URL: 'https://download.geofabrik.de/central-america/belize-latest.osm.pbf'
        COUNTRY_CODE: 'BZ'
      cuba:
        OSM_REGION: 'cuba'
        PBF_URL: 'https://download.geofabrik.de/central-america/cuba-latest.osm.pbf'
        COUNTRY_CODE: 'CU'
      guatemala:
        OSM_REGION: 'guatemala'
        PBF_URL: 'https://download.geofabrik.de/central-america/guatemala-latest.osm.pbf'
        COUNTRY_CODE: 'GT'
      haiti-and-domrep:
        OSM_REGION: 'haiti-and-domrep'
        PBF_URL: 'https://download.geofabrik.de/central-america/haiti-and-domrep-latest.osm.pbf'
        COUNTRY_CODE: 'HT'
      jamaica:
        OSM_REGION: 'jamaica'
        PBF_URL: 'https://download.geofabrik.de/central-america/jamaica-latest.osm.pbf'
        COUNTRY_CODE: 'JM'
      nicaragua:
        OSM_REGION: 'nicaragua'
        PBF_URL: 'https://download.geofabrik.de/central-america/nicaragua-latest.osm.pbf'
        COUNTRY_CODE: 'NI'
      albania:
        OSM_REGION: 'albania'
        PBF_URL: 'https://download.geofabrik.de/europe/albania-latest.osm.pbf'
        COUNTRY_CODE: 'AL'
      andorra:
        OSM_REGION: 'andorra'
        PBF_URL: 'https://download.geofabrik.de/europe/andorra-latest.osm.pbf'
        COUNTRY_CODE: 'AD'
      austria:
        OSM_REGION: 'austria'
        PBF_URL: 'https://download.geofabrik.de/europe/austria-latest.osm.pbf'
        COUNTRY_CODE: 'AT'
      azores:
        OSM_REGION: 'azores'
        PBF_URL: 'https://download.geofabrik.de/europe/azores-latest.osm.pbf'
        COUNTRY_CODE: 'PT'
      belarus:
        OSM_REGION: 'belarus'
        PBF_URL: 'https://download.geofabrik.de/europe/belarus-latest.osm.pbf'
        COUNTRY_CODE: 'BY'
      belgium:
        OSM_REGION: 'belgium'
        PBF_URL: 'https://download.geofabrik.de/europe/belgium-latest.osm.pbf'
        COUNTRY_CODE: 'BE'
      bosnia-herzegovina:
        OSM_REGION: 'bosnia-herzegovina'
        PBF_URL: 'https://download.geofabrik.de/europe/bosnia-herzegovina-latest.osm.pbf'
        COUNTRY_CODE: 'BA'
      bulgaria:
        OSM_REGION: 'bulgaria'
        PBF_URL: 'https://download.geofabrik.de/europe/bulgaria-latest.osm.pbf'
        COUNTRY_CODE: 'BG'
      croatia:
        OSM_REGION: 'croatia'
        PBF_URL: 'https://download.geofabrik.de/europe/croatia-latest.osm.pbf'
        COUNTRY_CODE: 'HR'
      cyprus:
        OSM_REGION: 'cyprus'
        PBF_URL: 'https://download.geofabrik.de/europe/cyprus-latest.osm.pbf'
        COUNTRY_CODE: 'CY'
      czech-republic:
        OSM_REGION: 'czech-republic'
        PBF_URL: 'https://download.geofabrik.de/europe/czech-republic-latest.osm.pbf'
        COUNTRY_CODE: 'CZ'
      denmark:
        OSM_REGION: 'denmark'
        PBF_URL: 'https://download.geofabrik.de/europe/denmark-latest.osm.pbf'
        COUNTRY_CODE: 'DK'
      estonia:
        OSM_REGION: 'estonia'
        PBF_URL: 'https://download.geofabrik.de/europe/estonia-latest.osm.pbf'
        COUNTRY_CODE: 'EE'
      faroe-islands:
        OSM_REGION: 'faroe-islands'
        PBF_URL: 'https://download.geofabrik.de/europe/faroe-islands-latest.osm.pbf'
        COUNTRY_CODE: 'FO'
      finland:
        OSM_REGION: 'finland'
        PBF_URL: 'https://download.geofabrik.de/europe/finland-latest.osm.pbf'
        COUNTRY_CODE: 'FI'
      france:
        OSM_REGION: 'france'
        PBF_URL: 'https://download.geofabrik.de/europe/france-latest.osm.pbf'
        COUNTRY_CODE: 'FR'
      georgia:
        OSM_REGION: 'georgia'
        PBF_URL: 'https://download.geofabrik.de/europe/georgia-latest.osm.pbf'
        COUNTRY_CODE: 'GE'
      germany:
        OSM_REGION: 'germany'
        PBF_URL: 'https://download.geofabrik.de/europe/germany-latest.osm.pbf'
        COUNTRY_CODE: 'DE'
      great-britain:
        OSM_REGION: 'great-britain'
        PBF_URL: 'https://download.geofabrik.de/europe/great-britain-latest.osm.pbf'
        COUNTRY_CODE: 'GB'
      greece:
        OSM_REGION: 'greece'
        PBF_URL: 'https://download.geofabrik.de/europe/greece-latest.osm.pbf'
        COUNTRY_CODE: 'GR'
      hungary:
        OSM_REGION: 'hungary'
        PBF_URL: 'https://download.geofabrik.de/europe/hungary-latest.osm.pbf'
        COUNTRY_CODE: 'HU'
      iceland:
        OSM_REGION: 'iceland'
        PBF_URL: 'https://download.geofabrik.de/europe/iceland-latest.osm.pbf'
        COUNTRY_CODE: 'IS'
      ireland-and-northern-ireland:
        OSM_REGION: 'ireland-and-northern-ireland'
        PBF_URL: 'https://download.geofabrik.de/europe/ireland-and-northern-ireland-latest.osm.pbf'
        COUNTRY_CODE: 'IE'
      isle-of-man:
        OSM_REGION: 'isle-of-man'
        PBF_URL: 'https://download.geofabrik.de/europe/isle-of-man-latest.osm.pbf'
        COUNTRY_CODE: 'IM'
      italy:
        OSM_REGION: 'italy'
        PBF_URL: 'https://download.geofabrik.de/europe/italy-latest.osm.pbf'
        COUNTRY_CODE: 'IT'
      kosovo:
        OSM_REGION: 'kosovo'
        PBF_URL: 'https://download.geofabrik.de/europe/kosovo-latest.osm.pbf'
        COUNTRY_CODE: 'XK'
      latvia:
        OSM_REGION: 'latvia'
        PBF_URL: 'https://download.geofabrik.de/europe/latvia-latest.osm.pbf'
        COUNTRY_CODE: 'LV'
      liechtenstein:
        OSM_REGION: 'liechtenstein'
        PBF_URL: 'https://download.geofabrik.de/europe/liechtenstein-latest.osm.pbf'
        COUNTRY_CODE: 'LI'
      lithuania:
        OSM_REGION: 'lithuania'
        PBF_URL: 'https://download.geofabrik.de/europe/lithuania-latest.osm.pbf'
        COUNTRY_CODE: 'LT'
      luxembourg:
        OSM_REGION: 'luxembourg'
        PBF_URL: 'https://download.geofabrik.de/europe/luxembourg-latest.osm.pbf'
        COUNTRY_CODE: 'LU'
      macedonia:
        OSM_REGION: 'macedonia'
        PBF_URL: 'https://download.geofabrik.de/europe/macedonia-latest.osm.pbf'
        COUNTRY_CODE: 'MK'
      malta:
        OSM_REGION: 'malta'
        PBF_URL: 'https://download.geofabrik.de/europe/malta-latest.osm.pbf'
        COUNTRY_CODE: 'MT'
      moldova:
        OSM_REGION: 'moldova'
        PBF_URL: 'https://download.geofabrik.de/europe/moldova-latest.osm.pbf'
        COUNTRY_CODE: 'MD'
      monaco:
        OSM_REGION: 'monaco'
        PBF_URL: 'https://download.geofabrik.de/europe/monaco-latest.osm.pbf'
        COUNTRY_CODE: 'MC'
      montenegro:
        OSM_REGION: 'montenegro'
        PBF_URL: 'https://download.geofabrik.de/europe/montenegro-latest.osm.pbf'
        COUNTRY_CODE: 'ME'
      netherlands:
        OSM_REGION: 'netherlands'
        PBF_URL: 'https://download.geofabrik.de/europe/netherlands-latest.osm.pbf'
        COUNTRY_CODE: 'NL'
      norway:
        OSM_REGION: 'norway'
        PBF_URL: 'https://download.geofabrik.de/europe/norway-latest.osm.pbf'
        COUNTRY_CODE: 'NO'
      poland:
        OSM_REGION: 'poland'
        PBF_URL: 'https://download.geofabrik.de/europe/poland-latest.osm.pbf'
        COUNTRY_CODE: 'PL'
      portugal:
        OSM_REGION: 'portugal'
        PBF_URL: 'https://download.geofabrik.de/europe/portugal-latest.osm.pbf'
        COUNTRY_CODE: 'PT'
      romania:
        OSM_REGION: 'romania'
        PBF_URL: 'https://download.geofabrik.de/europe/romania-latest.osm.pbf'
        COUNTRY_CODE: 'RO'
      russia:
        OSM_REGION: 'russia'
        PBF_URL: 'https://download.geofabrik.de/russia-latest.osm.pbf'
        COUNTRY_CODE: 'RU'
      serbia:
        OSM_REGION: 'serbia'
        PBF_URL: 'https://download.geofabrik.de/europe/serbia-latest.osm.pbf'
        COUNTRY_CODE: 'RS'
      slovakia:
        OSM_REGION: 'slovakia'
        PBF_URL: 'https://download.geofabrik.de/europe/slovakia-latest.osm.pbf'
        COUNTRY_CODE: 'SK'
      slovenia:
        OSM_REGION: 'slovenia'
        PBF_URL: 'https://download.geofabrik.de/europe/slovenia-latest.osm.pbf'
        COUNTRY_CODE: 'SI'
      spain:
        OSM_REGION: 'spain'
        PBF_URL: 'https://download.geofabrik.de/europe/spain-latest.osm.pbf'
        COUNTRY_CODE: 'ES'
      sweden:
        OSM_REGION: 'sweden'
        PBF_URL: 'https://download.geofabrik.de/europe/sweden-latest.osm.pbf'
        COUNTRY_CODE: 'SE'
      switzerland:
        OSM_REGION: 'switzerland'
        PBF_URL: 'https://download.geofabrik.de/europe/switzerland-latest.osm.pbf'
        COUNTRY_CODE: 'CH'
      turkey:
        OSM_REGION: 'turkey'
        PBF_URL: 'https://download.geofabrik.de/europe/turkey-latest.osm.pbf'
        COUNTRY_CODE: 'TR'
      ukraine:
        OSM_REGION: 'ukraine'
        PBF_URL: 'https://download.geofabrik.de/europe/ukraine-latest.osm.pbf'
        COUNTRY_CODE: 'UA'

#Short list of entries I wasn't 100% sure about and why:
#
#canary-islands — COUNTRY_CODE: "ES-CN" is non‑standard. Canary Islands belong to Spain (ES); remove “-CN” or use ES only.
#senegal-and-gambia — set to "SN" but the region contains both Senegal (SN) and The Gambia (GM). Decide SN, GM, or both.
#haiti-and-domrep — set to "HT" but includes Dominican Republic (DO) as well. Decide HT, DO, or split.
#ireland-and-northern-ireland — set to "IE" but includes Northern Ireland (part of GB/UK). Decide IE, GB, or split.
#gcc-states — set to "AE" but this is a multi‑country region (AE, SA, KW, OM, QA, BH). Needs a regional token or per‑country split.
#malaysia-singapore-brunei — set to "MY" but covers MY, SG, BN. Decide one or list multiple.
#israel-and-palestine — set to "IL" but could include PS (Palestine) as well; clarify desired code(s).
#kosovo — "XK" is a common user‑assigned code (not official ISO); confirm if acceptable.
#swaziland — "SZ" is correct code but country renamed to Eswatini (no code change); just noting.

  steps:

  - task: DownloadPipelineArtifact@2
    enabled: true
    inputs:
      buildType: 'specific'
      project: 'f85b0393-1484-487a-b6d1-5120b54a70be'
      definition: '3'
      buildVersionToDownload: 'latest'
      itemPattern: 'osm-data-$(OSM_REGION)/$(OSM_REGION).osm.pbf'
      targetPath: '$(System.DefaultWorkingDirectory)'

  - task: Bash@3
    displayName: 'filter and export polygons'
    inputs:
      targetType: 'inline'
      script: |
        set -x
        ls -la
        pwd
        osmium --version

        INPUT_PBF=osm-data-$(OSM_REGION)/$(OSM_REGION).osm.pbf
        ADMIN_PBF=$(OSM_REGION).admins.pbf
        POLYGON_JSON=$(OSM_REGION).admin-polygons.geojsonseq

        osmium tags-filter --output ${ADMIN_PBF} --overwrite ${INPUT_PBF} boundary=administrative
        osmium export ${ADMIN_PBF} --output=temp.geojsonseq --overwrite --config=osmium-export-config.json

        #omit polygons without name, admin_level and wikidata reference
        cat temp.geojsonseq | grep "admin_level" | grep "name" | grep "wikidata" > ${POLYGON_JSON}

  - task: PublishPipelineArtifact@1
    enabled: true
    displayName: 'Store polygon artifacts'
    inputs:
      targetPath: '$(OSM_REGION).admin-polygons.geojsonseq'
      artifact: 'admin-polygons-$(OSM_REGION)'
      publishLocation: 'pipeline'
